@using Microsoft.AspNetCore.Components.Web

<div>
    <div class="d-flex gap-2">
        <input class="form-control" @bind="newItem" @onkeydown="HandleKeyDown" placeholder="@Placeholder" />
        <button type="button" class="btn btn-outline-primary" @onclick="AddItem">Add</button>
    </div>

    <div class="mt-2">
        @if (Value is null || Value.Count == 0)
        {
            <div class="text-muted small">No items.</div>
        }
        else
        {
            <div class="d-flex flex-wrap gap-2">
                @for (int i = 0; i < Value.Count; i++)
                {
                    <div class="badge bg-light border text-dark d-flex align-items-center" style="padding:6px;">
                        <span>@Value[i]</span>
                        <button type="button" class="btn-close btn-close-small ms-2" aria-label="Remove" @onclick="() => RemoveItem(i)"></button>
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public List<string> Value { get; set; } = new();

    [Parameter]
    public EventCallback<List<string>> ValueChanged { get; set; }

    [Parameter]
    public string Placeholder { get; set; } = "";

    private string? newItem;

    private async Task AddItem()
    {
        if (string.IsNullOrWhiteSpace(newItem))
        {
            return;
        }

        if (Value == null) Value = new List<string>();
        var item = newItem.Trim();
        if (!Value.Contains(item, StringComparer.OrdinalIgnoreCase))
        {
            Value.Add(item);
            await ValueChanged.InvokeAsync(Value);
        }

        newItem = null;
    }

    private async Task RemoveItem(int index)
    {
        if (Value == null || index < 0 || index >= Value.Count) return;
        Value.RemoveAt(index);
        await ValueChanged.InvokeAsync(Value);
    }

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await AddItem();
        }
    }
}