@page "/Settings"
@rendermode InteractiveServer
@inject TranslationStateService State
@inject NavigationManager Nav

<div class="background">
    <div class="heading">
        <h1><b>Settings</b></h1>
    </div>

    <div class="panel1">
        <h2><b>Language</b></h2>

        <select @bind="SelectedLang" class="form-select mb-3">
            <option value="">English (Default)</option>
            <option value="es">Spanish (Español)</option>
            <option value="fr">French (Français)</option>
            <option value="de">German (Deutsch)</option>
            <option value="zh-CN">Chinese (简体中文)</option>
            <option value="ja">Japanese (日本語)</option>
        </select>

        <button class="btn btn-primary" @onclick="ApplyLanguage">Apply Language</button>
        
        <div class="mt-3">
            <p>Current Language: <strong>@GetCurrentLanguageName()</strong></p>
            <p class="text-muted small">Note: Text will translate automatically as you browse pages.</p>
        </div>
    </div>
</div>

@code {
    private string SelectedLang = "";

    protected override void OnInitialized()
    {
        SelectedLang = State.CurrentLanguage ?? "";
    }

    private void ApplyLanguage()
    {
        State.CurrentLanguage = string.IsNullOrEmpty(SelectedLang) ? null : SelectedLang;
        
        // Navigate to home to see the translation in action
        Nav.NavigateTo("/");
    }

    private string GetCurrentLanguageName()
    {
        if (string.IsNullOrEmpty(State.CurrentLanguage))
            return "English";
        
        var names = new Dictionary<string, string>
        {
            ["es"] = "Spanish",
            ["fr"] = "French",
            ["de"] = "German",
            ["zh-CN"] = "Chinese",
            ["ja"] = "Japanese"
        };

        return names.GetValueOrDefault(State.CurrentLanguage, State.CurrentLanguage);
    }
}
